# 인덱스(INDEX)

`인덱스`는 데이터베이스의 성능에 아주 중요한 영향을 미치기 때문에 없어서는 안 될 중요한 개체이다.

특히 SELECT 문을 사용할 때 데이터에 빠르게 접근할 수 있도록 도와준다.

서버 입장에서는 적은 처리량으로 결과를 얻음으로써 다른 요청을 더 많이 처리할 수 있어 결과적으로 전체 시스템의 성능이 향상된다.

인덱스를 적절히 사용하면 시스템의 성능이 향상되지만 그렇지 않으면 오히려 성능이 떨어지기도 한다.

테이블 열(칼럼) 단위로 생성한다.

- 인덱스란?

  데이터를 좀 더 빨리 찾을 수 있도록 도와주는 도구

- 인덱스의 장점

  검색 속도가 매우 빨라진다(항상 그런 것은 아니다.)

  그 결과 해당 쿼리의 부하가 줄어들어 결국 시스템 전체의 성능이 향상된다.

- 인덱스의 단점

  인덱스를 저장할 공간이 필요하다. 대략 데이터베이스 크기의 10% 정도 추가 공간이 필요하다.

  처음 인덱스를 생성하는 데 많은 시간이 소요된다.

  데이터의 변경(삽입, 수정, 삭제) 작업이 자주 일어날 경우 오히려 성능이 나빠질 수 있다.

---

## 인덱스의 종류

- 클러스터형 인덱스

  테이블당 하나만 생성할 수 있으며 `영어 사전`과 같다.

  행 데이터를 인덱스로 지정한 열에 맞춰서 자동으로 정렬한다. (오름차순)

- 보조 인덱스

  테이블당 여러 개를 생성할 수 있으며 `찾아보기가 있는 책`과 같다.

`UNIQUE`제약 조건은 한 테이블에 여러 개를 설정할 수 있으며 보조 인덱스가 자동으로 생성된다.

`UNIQUE`제약 조건에 `NOT NULL`을 설정하면 `클러스터형 인덱스`가 생성된다.

`PRIMARY`와 `UNIQUE NOT NULL`을 설정해준 열이 둘 다 존재한다면 PRIMARY로 설정된 열이 클러스터형 인덱스가 된다.

정리하자면

- PRIMARY KEY로 지정한 열에 클러스터형 인덱스가 생성된다.
- UNIQUE NOT NULL로 지정한 열에 클러스터형 인덱스가 생성된다.
- UNIQUE 또는 UNIQUE NULL로 지정한 열에 보조 인덱스가 생성된다.
- PRIMARY KEY와 UNIQUE NOT NULL이 같이 있으면 PRIMARY KEY로 지정한 열에 우선 클러스터형 인덱스가 생성된다.

---

## B-Tree

- 클러스터형 인덱스의 특징

  인덱스를 생성할 때 데이터 페이지 전체가 다시 정렬된다. 이미 대용량 데이터가 입력된 상태에서 중간에 클러스터형 인덱스를 생성하면 시스템에 심각한 부하를 줄 수 있다.

  리프 페이지가 곧 데이터 페이지이다. 인덱스 자체에 데이터가 포함되어 있다.

  보조 인덱스보다 검색 속도가 빠르고 데이터 변경(삽입, 수정, 삭제) 속도는 느리다.

  클러스터형 인덱스는 테이블에 하나만 생성할 수 있다. 따라서 어느 열에 클러스터형 인덱스를 생성하는지에 따라 시스템의 성능이 달라진다.

- 보조 인덱스의 특징

  인덱스를 생성할 때 데이터 페이지는 그대로 둔 상태에서 별도의 페이지에 인덱스를 구성한다.

  리프 페이지에 데이터가 아니라 데이터가 위치하는 주소 값(RID)이 들어 있다.

  데이터 변경(삽입, 수정, 삭제) 시 클러스터형 인덱스보다 성능 부하가 적다.

  보조 인덱스는 한 테이블에 여러 개를 생성할 수 있다. 하지만 함부로 남용하면 오히려 시스템의 성능을 떨어뜨리는 결과를 초래할 수 있으므로 필요한 열에만 생성해야 한다.

---

## 인덱스 생성 및 삭제

- 인덱스를 생성하는 방법
  1. 테이블에 제약 조건을 설정하여 자동으로 생성하는 방법
  2. 인덱스를 생성하는 구문을 입력하여 생성하는 방법

`CREATE INDEX`문으로 인덱스를 만들면 보조 인덱스가 생성된다.

`ALTER INDEX`문으로 클러스터형 인덱스를 만들어야 한다.

`CREATE INDEX`문의 UNIQUE 옵션은 고유한 인덱스를 만들 때 사용된다.

인덱스 삭제 쿼리문

```sql
-- 보조 인덱스 삭제할 때
DROP INDEX 인덱스이름 ON 테이블이름;

-- PRIMARY 삭제할 때

DROP INDEX PRIMARY ON 테이블이름;
```

`ALTER TABLE`문으로 기본키를 삭제하면 클러스터형 인덱스도 같이 삭제되므로 그 방법을 이용해도 된다.

```sql
ALTER TABLE 테이블이름 DROP PRIMARY KEY;
```

인덱스 생성할 때

```sql
CREATE INDEX 인덱스이름 ON 테이블이름 (컬럼명);
```

두 열을 하나의 인덱스로 설정할 때

```sql
CREATE INDEX 인덱스이름 ON 테이블이름 (컬럼명1, 컬럼명2);
```

---

## 인덱스 생성 기준

- 인덱스는 열 단위에 생성한다.
- 인덱스는 WHERE 절에서 사용되는 열에 만든다.
- WHERE 절에 사용되는 열이라도 자주 사용해야 가치가 있다.
- 데이터 중복도가 높은 열에는 인덱스를 만들어도 효과가 없다.
- 외래키를 설정한 열에는 자동으로 외래키 인덱스가 생성된다.
- 조인에 자주 사용되는 열에는 인덱스를 생성하는 것이 좋다.
- 데이터 변경(삽입, 수정, 삭제) 작업이 얼마나 자주 일어나는지 고려한다.
- 클러스터형 인덱스는 테이블당 하나만 생성할 수 있다.
- 테이블에 클러스터형 인덱스가 아예 없는 것이 좋은 경우도 있다.
- 사용하지 않는 인덱스는 제거한다.
